"use strict";function epoch2date(t){var l=new Date(1e3*t);return(l=l.toGMTString().split(" "))[1]+" "+l[2]+" "+l[3]}function epoch2GMT(t){var l=new Date(1e3*t);return l=l.toGMTString().split("GMT")[0]}function getOffset(t,l){return-1*t+(t>l?t:l)/2}function getBase0byId(t,l){for(var o=0;o<t.length;o++)t[o].id==l&&(l=o);return l}function updateTitle(){document.title=""==location.hash?"Poll Listing":"Single Poll - "+location.hash.replace("#","")}Vue.component("poll-today",{props:["poll"],data:{voted:!1},template:'\t<div class="poll-today">\t<div class="inner">\t<h1>Today\'s Poll</h1>\t<p class="title">{{ poll.title }} <span class="date-label">{{ epoch2date(poll.publishedDate)\t}}</span></p>\t<div class="chart"><svg width="150px" height="150px" viewBox="0 0 42 42" class="donut">\t<circle class="donut-hole" cx="21" cy="21" r="15.91549430918954" fill="transparent"></circle>\t<circle class="donut-ring" cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="#d77a44" stroke-width="8"></circle><circle id="circle" class="donut-segment" cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="#1e3a67" stroke-width="8" v-bind:stroke-dasharray="poll.strokeDasharray" v-bind:stroke-dashoffset="getOffset(poll.bluePercent, poll.orangePercent)"></circle></svg>\t\t<p>{{poll.bluePercent}}<span></span>{{poll.orangePercent}}</p></div>\t<div class="vote-buttons" v-bind:class="{ voted: poll.voted }">\t<div  v-on:click="vm.vote(poll.id,poll.answer.options[0].id);poll.voted=true;" class="vote-button vote-button1">{{ poll.answer.options[0].label\t}}</div>\t<div  v-on:click="vm.vote(poll.id,poll.answer.options[1].id);poll.voted=true;" class="vote-button vote-button2">{{ poll.answer.options[1].label }}</div>\t</div>\t<p class="total-vote">Total number of votes recored: {{ poll.total }}</p>\t</div>\t<div class="doted-line"></div>\t</div>'}),Vue.component("poll-item",{props:["poll"],template:'\t<div class="poll">\t<a v-bind:href="\'#\'+poll.id" v-on:click="vm.loadSinglePoll(poll.id)">\t<div class="left">\t<img src="images/poll-icon.png" alt="" /> \t</div><div class="right">\t<div class="date-label">{{ epoch2date(poll.publishedDate)\t}}</div> \t<p class="title">{{ poll.title }}</p>\t</div></a>\t</div>\t'}),Vue.component("single-poll",{props:["poll"],template:'<div><a class="back" href="" v-on:click="vm.currentPage = \'poll-listing\' ">< Back</a><div class="upper">\t<h1 class="title">{{poll.title}}</h1>\t<div class="doted-line"></div>\t<p class="date">PUBLISHED: {{ epoch2GMT(poll.publishedDate)\t}}</p>\t</div>\t<div class="wrapper">\t<div class="inner">\t<h1 class="title">{{poll.title}}</h1>\t<div class="left">\t<div class="vote-buttons">\t<div class="vote-button vote-button1" v-on:click="vm.vote(poll.id,poll.answer.options[0].id);poll.voted=true;">{{ poll.answer.options[0].label\t}}</div> \t<div class="vote-button vote-button2" v-on:click="vm.vote(poll.id,poll.answer.options[1].id);poll.voted=true;">{{ poll.answer.options[1].label\t}}</div>\t</div>\t\t\t</div><div class="right">\t<div class="chart"><svg width="150px" height="150px" viewBox="0 0 42 42" class="donut">\t<circle class="donut-hole" cx="21" cy="21" r="15.91549430918954" fill="transparent"></circle>\t<circle class="donut-ring" cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="#d77a44" stroke-width="8"></circle><circle id="circle" class="donut-segment" cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="#1e3a67" stroke-width="8" v-bind:stroke-dasharray="poll.strokeDasharray" v-bind:stroke-dashoffset="getOffset(poll.bluePercent, poll.orangePercent)"></circle></svg>\t\t<p>{{poll.bluePercent}}<span></span>{{poll.orangePercent}}</p></div>\t\t\t\t\t</div>\t<p class="total-vote">Total number of votes recored: {{ poll.total }}</p>\t\t\t\t\t\t</div>\t</div></div>\t'});var vm=new Vue({el:"#vue",data:{currentPage:""==location.hash?"poll-listing":"single-poll",pollUrl:"assets/poll.json",pollList:[{id:"",title:"",total:"",answer:{options:{0:"",1:""}}}],singlePoll:[{id:"",title:"",total:"",answer:{options:{0:"",1:""}}}]},methods:{loadPolls:function(t){this.$http.get(this.pollUrl).then(function(l){t=getBase0byId(l.body.polls,t),console.log("today in term of arr idx is %s",t),l.body.polls[t].total="",l.body.polls[t].strokeDasharray="",l.body.polls[t].orangePercent="",l.body.polls[t].bluePercent="",console.log(l.body.polls),this.pollList=l.body.polls,this.singlePoll[0]=this.pollList[t],this.$http.get("vote.php?pid="+this.pollList[t].id).then(function(l){console.log(l.body),vm.pollList[t].total=l.body.total,vm.singlePoll[0].total=l.body.total;var o=vm.pollList[t].answer.options[0].id,e=(vm.pollList[t].answer.options[1].id,parseInt(parseInt(l.body.votes[o])/l.body.total*100)),s=100-e;isNaN(s)&&(s=0),isNaN(e)&&(e=0),vm.pollList[t].bluePercent=s,vm.pollList[t].orangePercent=e,vm.pollList[t].strokeDasharray=s+" "+e}).catch(function(t){console.log(t)})}).catch(function(t){console.log(t)})},vote:function(t,l){console.log("%s %s",t,l),this.$http.post("vote.php","pid="+t+"&optionKey="+l,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(l){var o=JSON.parse(l.body);console.log(o);var e=getBase0byId(vm.pollList,t);vm.pollList[e].total=o.total;var s=vm.pollList[e].answer.options[0].id,i=(vm.pollList[e].answer.options[1].id,parseInt(parseInt(o.votes[s])/o.total*100)),a=100-i;isNaN(a)&&(a=0),isNaN(i)&&(i=0),vm.pollList[e].bluePercent=a,vm.pollList[e].orangePercent=i,vm.pollList[e].strokeDasharray=a+" "+i,console.log("bluePercent orangePercent:"+a+" "+i),vm.singlePoll[0].bluePercent=a,vm.singlePoll[0].orangePercent=i,vm.singlePoll[0].strokeDasharray=a+" "+i}).catch(function(t){console.log(t)})},loadSinglePoll:function(t){console.log(t),this.loadPolls(t)}},mounted:function(){this.loadPolls(""==location.hash?1:location.hash.replace("#","")),updateTitle()}});window.addEventListener("hashchange",function(){vm.currentPage=""==location.hash?"poll-listing":"single-poll",updateTitle()},!1);